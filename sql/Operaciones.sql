SELECT OPER.* FROM FOREX.OPERACION OPER
WHERE ID_INDIVIDUO IN (
--'1332993893287.1747'
--'1331998280983.413',
'1341461435364.12659'
)
--AND FECHA_CIERRE IS NULL
ORDER BY FECHA_APERTURA ASC;

SELECT * FROM OPERACION WHERE FECHA_CIERRE<=FECHA_APERTURA;

UPDATE OPERACION SET FECHA_CIERRE=NULL -- WHERE ID_INDIVIDUO='1338171613583.42' 
WHERE FECHA_CIERRE<FECHA_APERTURA;

SELECT ROUND(FECHA_CIERRE-FECHA_APERTURA,5)*24*60 DUR, 
  TO_CHAR(FECHA_APERTURA, 'DAY') APERT, TO_CHAR(FECHA_CIERRE, 'DAY') CIERRE,
  OPER.* FROM FOREX.OPERACION OPER
WHERE ID_INDIVIDUO IN ('1331600380960.14951')
AND PIPS>0 
ORDER BY FECHA_APERTURA ASC;

SELECT STDDEV(ROUND(FECHA_CIERRE-FECHA_APERTURA,5)*24*60) FROM OPERACION 
WHERE ID_INDIVIDUO IN ('1331600380960.14951')
GROUP BY ID_INDIVIDUO;

SELECT ID_INDIVIDUO, TO_CHAR(FECHA_APERTURA,'YYYY'), SUM(PIPS), count(*)
FROM FOREX.OPERACION WHERE ID_INDIVIDUO IN ('1341461435364.12659')
GROUP BY ID_INDIVIDUO, TO_CHAR(FECHA_APERTURA, 'YYYY') 
ORDER BY ID_INDIVIDUO, TO_CHAR(FECHA_APERTURA, 'YYYY') DESC;

SELECT TO_CHAR(OPER.FECHA_APERTURA, 'YYYY/MM/DD HH24:MI') FECHA, COUNT(*), SUM(PIPS) 
FROM OPERACION GROUP BY TO_CHAR(FECHA_APERTURA, 'YYYY/MM/DD HH24:MI')
--HAVING COUNT(*) > 100
ORDER BY COUNT(*) DESC;
---ORDER BY TO_CHAR(FECHA_APERTURA, 'YYYY/MM/DD HH24:MI') DESC;

SELECT OPER.FECHA_APERTURA, COUNT(*), SUM(OPER.PIPS) 
FROM OPERACION OPER
  INNER JOIN (select * from TEMP_VIEW where rownum<10) TV ON OPER.ID_INDIVIDUO=TV.ID_INDIVIDUO
GROUP BY OPER.FECHA_APERTURA
--HAVING COUNT(*) > 100
--ORDER BY COUNT(*) DESC
;

SELECT * FROM OPERACION oper
  INNER JOIN (select * from TEMP_VIEW where rownum<10) TV ON OPER.ID_INDIVIDUO=TV.ID_INDIVIDUO
WHERE FECHA_APERTURA=TO_DATE('2008/05/09 20:48','YYYY/MM/DD HH24:MI')
ORDER BY PIPS DESC;

SELECT * FROM TEMP_VIEW;

SELECT OPER.ID_INDIVIDUO, OPER.FECHA_APERTURA, OPER.OPEN_PRICE, OPER.SPREAD, OPER.LOTE 
FROM OPERACION OPER
 WHERE OPER.FECHA_APERTURA<=--(select max(fecha)-1 from datohistorico)
 (TO_DATE('2011/03/17 01:31','YYYY/MM/DD HH24:MI')) 
  AND (OPER.FECHA_CIERRE IS NULL OR OPER.FECHA_CIERRE>--(select max(fecha)-1 from datohistorico))
 (TO_DATE('2011/03/17 01:31','YYYY/MM/DD HH24:MI')))
 ;
                
SELECT IND.ID ID_INDIVIDUO, MAX(PROC.FECHA_HISTORICO) FECHA_HISTORICO, MAX(OPER.FECHA_APERTURA) FECHA_APERTURA 
FROM INDIVIDUO IND 
LEFT JOIN PROCESO PROC ON IND.ID=PROC.ID_INDIVIDUO 
LEFT JOIN OPERACION OPER ON IND.ID=OPER.ID_INDIVIDUO AND OPER.FECHA_CIERRE IS NULL 
WHERE IND.ID NOT IN (SELECT DISTINCT PRO.ID_INDIVIDUO FROM PROCESO PRO WHERE PRO.FECHA_HISTORICO=(SELECT MAX(FECHA) FROM DATOHISTORICO)) 
AND IND.ID='1332696593249.74'
GROUP BY IND.ID 
ORDER BY IND.ID DESC ;

SELECT * FROM FOREX.PROCESO
WHERE ID_INDIVIDUO IN ('1343965743765.436')
ORDER BY FECHA_HISTORICO DESC;

SELECT * FROM OPERACION ORDER BY ID_INDIVIDUO ASC, FECHA_APERTURA ASC;

SELECT ID_INDIVIDUO, COUNT(*), SUM(PIPS) FROM FOREX.OPERACION GROUP BY ID_INDIVIDUO 
ORDER BY SUM(PIPS) DESC
--ORDER BY COUNT(*) DESC
;

SELECT * FROM OPERACION ORDER BY FECHA_APERTURA ASC;

SELECT COUNT(*) FROM FOREX.OPERACION;

SELECT COUNT(DISTINCT ID_INDIVIDUO) FROM FOREX.PROCESO;
SELECT * FROM FOREX.PROCESO ORDER BY FECHA_PROCESO DESC;
/*SELECT * FROM FOREX.PROCESO PROC
  INNER JOIN FOREX.OPERACION OPER ON OPER.ID_INDIVIDUO=PROC.ID_INDIVIDUO
ORDER BY PROC.ID_INDIVIDUO ASC
;*/

SELECT * FROM FOREX.PROCESO WHERE ID_INDIVIDUO IN (
  SELECT IND.ID FROM FOREX.INDIVIDUO IND WHERE IND.CREATION_DATE IS NULL AND IND.PARENT_ID_1 IS NOT NULL AND IND.PARENT_ID_2 IS NOT NULL
  UNION ALL
  SELECT IND.ID FROM FOREX.INDIVIDUO_BORRADO IND WHERE IND.CREATION_DATE IS NULL AND IND.PARENT_ID_1 IS NOT NULL AND IND.PARENT_ID_2 IS NOT NULL
) ORDER BY FECHA_PROCESO DESC;

SELECT * FROM FOREX.PROCESO WHERE ID_INDIVIDUO IN (
  SELECT IND.ID FROM FOREX.INDIVIDUO IND WHERE IND.CREATION_DATE IS NOT NULL AND IND.CREATION_DATE 
    BETWEEN TO_DATE('2012/06/07', 'YYYY/MM/DD') AND TO_DATE('2012/08/07', 'YYYY/MM/DD')
  UNION ALL
    SELECT IND.ID FROM FOREX.INDIVIDUO_BORRADO IND WHERE IND.CREATION_DATE IS NOT NULL AND IND.CREATION_DATE 
    BETWEEN TO_DATE('2012/06/07', 'YYYY/MM/DD') AND TO_DATE('2012/08/07', 'YYYY/MM/DD')
  )
ORDER BY FECHA_PROCESO DESC;

SELECT * FROM FOREX.PROCESO WHERE ID_INDIVIDUO IN (
  SELECT IND.ID FROM FOREX.INDIVIDUO IND WHERE IND.CREATION_DATE IS NOT NULL AND IND.CREATION_DATE 
  BETWEEN TO_DATE('2012/05/07', 'YYYY/MM/DD') AND TO_DATE('2012/06/06', 'YYYY/MM/DD')
  UNION ALL
  SELECT IND.ID FROM FOREX.INDIVIDUO_BORRADO IND WHERE IND.CREATION_DATE IS NOT NULL AND IND.CREATION_DATE 
  BETWEEN TO_DATE('2012/05/07', 'YYYY/MM/DD') AND TO_DATE('2012/06/06', 'YYYY/MM/DD')

  )
ORDER BY FECHA_PROCESO DESC;

SELECT SUM(PIPS) FROM FOREX.OPERACION WHERE ID_INDIVIDUO='1329927210938.97';

SELECT * FROM FOREX.PROCESO WHERE ID_INDIVIDUO='1339124687689.853' 
ORDER BY FECHA_PROCESO DESC;

SELECT * FROM FOREX.PROCESO WHERE ID_INDIVIDUO='1329850420864.9747' ORDER BY FECHA_HISTORICO DESC;

SELECT * FROM FOREX.OPERACION_BASE WHERE ID_INDIVIDUO='1341687718670.3284'
ORDER BY ID_INDIVIDUO,FECHA_APERTURA DESC;

SELECT * FROM FOREX.V_OPERACIONES 
WHERE ID='1329927210938.986'
AND OPEN_FECHA=TO_DATE('2008/10/29 17:43','YYYY/MM/DD HH24:MI')
AND CLOSE_FECHA=TO_DATE('2008/10/29 17:50','YYYY/MM/DD HH24:MI')
ORDER BY ID,OPEN_FECHA;

SELECT * FROM FOREX.OPERACION ORDER BY ID_INDIVIDUO,FECHA_APERTURA;

SELECT * FROM FOREX.OPERACION_BASE WHERE ID_INDIVIDUO IN (
  SELECT ID_INDIVIDUO FROM FOREX.OPERACION 
  GROUP BY ID_INDIVIDUO HAVING COUNT(*) > 1)
ORDER BY ID_INDIVIDUO,FECHA_APERTURA;

SELECT OPER.*
FROM FOREX.DATOHIST_INDICADORINDIVIDUO OPER
WHERE OPER.ID_INDIVIDUO='1343862270390.14'
AND OPER.OPEN_FECHA=TO_DATE('2011/02/28 17:13','YYYY/MM/DD HH24:MI')
AND CLOSE_FECHA=TO_DATE('2011/03/15 04:46','YYYY/MM/DD HH24:MI')
;	

  SELECT MIN(FECHA) FROM DATOHISTORICO WHERE FECHA > TO_DATE('2008/05/08 02:29','YYYY/MM/DD HH24:MI');
  SELECT * FROM DATOHISTORICO WHERE FECHA=TO_DATE('2008/05/08 02:33','YYYY/MM/DD HH24:MI');
  SELECT 1.01179-(-0.00065),  1.01179-(-0.00039), 1.0114, 1.0126 ,
    (INTERSECT_INTERVAL(1.01179-(-0.00039), 1.01179-(-0.00065), 1.0114, 1.0126)) INTER FROM DUAL;

SELECT * FROM FOREX.OPERACION_BASE OPB1 
WHERE EXISTS (SELECT 1 FROM FOREX.OPERACION_BASE OPB2 WHERE 
OPB1.ID_INDIVIDUO=OPB2.ID_INDIVIDUO AND OPB1.FECHA_APERTURA > OPB2.FECHA_APERTURA AND OPB1.FECHA_APERTURA <= OPB2.FECHA_CIERRE)
ORDER BY OPB1.ID_INDIVIDUO,FECHA_APERTURA;

SELECT * FROM (
  SELECT * FROM FOREX.OPERACION_BASE WHERE ID_INDIVIDUO IN (
    SELECT ID_INDIVIDUO FROM FOREX.OPERACION 
    GROUP BY ID_INDIVIDUO HAVING COUNT(*) > 1)
  ORDER BY ID_INDIVIDUO,FECHA_APERTURA) OPM
WHERE OPM.ID_INDIVIDUO NOT IN (
  SELECT ID_INDIVIDUO FROM FOREX.OPERACION_BASE OPB1 
  WHERE EXISTS (SELECT 1 FROM FOREX.OPERACION_BASE OPB2 WHERE 
  OPB1.ID_INDIVIDUO=OPB2.ID_INDIVIDUO AND OPB1.FECHA_APERTURA > OPB2.FECHA_APERTURA AND OPB1.FECHA_APERTURA <= OPB2.FECHA_CIERRE)
);  

SELECT ID_INDIVIDUO, COUNT(*) 
FROM OPERACION OPER 
WHERE ID_INDIVIDUO IN (
'1331998280983.655',
'1332136117425.232',
'1338955830567.163988',
'1341885059860.39746',
'1327755218940.41',
'1331598834464.9',
'1331599478796.18',
'1331599478796.330',
'1332696593249.562',
'1338955830567.230365',
'1341687718670.73854',
'1327945200978.65861',
'1328008771989.56928',
'1329398391890.17068',
'1331599183507.432',
'1331599478796.41',
'1332121226350.72',
'1341790184229.101723',
'1328008600829.125367',
'1331599853600.43',
'1331776121804.2',
'1331784022202.3',
'1332136117425.22',
'1332812084948.1983',
'1338758091960.23282',
'1341790184229.115515',
'1341978770171.52754',
'1328406260521.97',
'1329845340127.561',
'1331998738681.675',
'1332121226350.23',
'1332391723361.31',
'1333069696483.4',
'1338507173394.340',
'1338606422074.2138',
'1338955830567.128180',
'1338955830567.239722',
'1342064824281.26207',
'1342885210101.175',
'1327680846349.8833',
'1329850420864.7283',
'1329927210938.11073',
'1331998280983.126',
'1331999548575.46',
'1332005130567.85',
'1332121226350.211',
'1332171586465.250',
'1333069696483.901',
'1338758091960.27559',
'1338758091960.31948'
)
GROUP BY ID_INDIVIDUO
ORDER BY COUNT(*);
